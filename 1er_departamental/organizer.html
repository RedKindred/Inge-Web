<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Organizador — Stock</title>
  <link rel="stylesheet" href="organizer.css">
</head>
<body>
  <header class="topbar">
    <div class="wrap">
      <h1 class="logo">Tienda Héroes</h1>
      <nav class="menu">
        <a href="landing.html">Inicio</a>
        <a href="user.html">Usuario</a>
        <a href="organizer.html">Organizador</a>
        <a href="admin.html">Admin</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <h2>Gestión de stock</h2>
    <form id="formProducto" class="panel">
      <div class="fila">
        <label>SKU</label><input id="sku">
        <label>Nombre</label><input id="nombre">
      </div>
      <div class="fila">
        <label>Precio</label><input id="precio" type="number" step="0.01">
        <label>Existencias</label><input id="existencias" type="number" step="1">
      </div>
      <div class="fila">
        <label>Imagen URL</label><input id="imagen">
      </div>
      <button type="button" class="btn" id="btnCrear">Crear</button>
      <button type="button" class="btn" id="btnActualizar" disabled>Actualizar</button>
      <button type="button" class="btn danger" id="btnEliminar" disabled>Eliminar</button>
      <input type="hidden" id="idProducto">
    </form>

    <h3>Productos</h3>
    <div id="status" class="status"></div>
    <table class="tabla" id="tablaProductos">
      <thead>
        <tr><th>ID</th><th>SKU</th><th>Nombre</th><th>Precio</th><th>Existencias</th><th>Imagen</th><th>Acción</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
  const API = {
    list: () => fetch('/api/products').then(r=>r.json()),
    create: (p) => fetch('/api/products', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(p)}).then(r=>r.json()),
    update: (id, p) => fetch('/api/products/'+id, {method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify(p)}).then(r=>r.json()),
    del: (id) => fetch('/api/products/'+id, {method:'DELETE'}).then(r=>r.json()),
  };
  const tbody = document.querySelector('#tablaProductos tbody');
  const statusEl = document.getElementById('status');
  const f = (id)=>document.getElementById(id);

  async function cargar(){
    statusEl.textContent = 'Cargando…';
    tbody.innerHTML = '';
    const data = await API.list();
    statusEl.textContent = '';
    (data.products||[]).forEach(p=>{
      const tr = document.createElement('tr');
      tr.innerHTML = \`
        <td>\${p.id}</td>
        <td>\${p.sku||''}</td>
        <td>\${p.nombre||''}</td>
        <td>\${p.precio?.toFixed ? p.precio.toFixed(2) : p.precio}</td>
        <td>\${p.existencias}</td>
        <td><img src="\${p.imagen||'https://via.placeholder.com/80x80?text=Sin+img'}" class="thumb"></td>
        <td><button class="btn sel" data-id="\${p.id}">Seleccionar</button></td>
      \`;
      tbody.appendChild(tr);
    });
  }

  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('.sel');
    if (!btn) return;
    const id = btn.getAttribute('data-id');
    const row = btn.closest('tr').children;
    f('idProducto').value = id;
    f('sku').value = row[1].textContent.trim();
    f('nombre').value = row[2].textContent.trim();
    f('precio').value = row[3].textContent.trim();
    f('existencias').value = row[4].textContent.trim();
    f('imagen').value = row[5].querySelector('img').src || '';
    f('btnActualizar').disabled = false;
    f('btnEliminar').disabled = false;
  });

  f('btnCrear').addEventListener('click', async ()=>{
    const p = { sku:f('sku').value, nombre:f('nombre').value, precio:parseFloat(f('precio').value||0), existencias:parseInt(f('existencias').value||0), imagen:f('imagen').value };
    await API.create(p); await cargar();
  });
  f('btnActualizar').addEventListener('click', async ()=>{
    const id = f('idProducto').value; if (!id) return;
    const p = { sku:f('sku').value, nombre:f('nombre').value, precio:parseFloat(f('precio').value||0), existencias:parseInt(f('existencias').value||0), imagen:f('imagen').value };
    await API.update(id, p); await cargar();
  });
  f('btnEliminar').addEventListener('click', async ()=>{
    const id = f('idProducto').value; if (!id) return;
    await API.del(id); await cargar();
  });

  document.addEventListener('DOMContentLoaded', cargar);
  </script>
</body>
</html>
